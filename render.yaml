services:
  - type: web
    name: timetracker
    runtime: docker
    plan: starter
    region: frankfurt
    healthCheckPath: /_health
    numInstances: 1
    dockerfilePath: ./Dockerfile
    preDeployCommand: flask db upgrade
    disk:
      name: timetracker-data
      mountPath: /data
      sizeGB: 1
    envVars:
      # Minimal required env for TimeTracker SaaS on Render.
      # Everything else is optional and can be configured via the app UI / tenant settings.
      - key: FLASK_ENV
        value: production
      - key: FLASK_DEBUG
        value: "false"
      - key: SECRET_KEY
        generateValue: true
      - key: DATABASE_URL
        fromDatabase:
          name: timetracker-db
          property: connectionString

      # SaaS / tenancy
      - key: SAAS_MODE
        value: "true"
      - key: TENANCY_MODE
        value: multi
      - key: TENANT_ROUTING
        value: path
      - key: TENANT_PATH_PREFIX
        value: /t
      - key: DEFAULT_TENANT_SLUG
        value: default

      # Stripe billing (required for SaaS tiers)
      - key: STRIPE_SECRET_KEY
        sync: false
      - key: STRIPE_WEBHOOK_SECRET
        sync: false
      - key: STRIPE_PRICE_BASIC
        sync: false
      - key: STRIPE_PRICE_TEAM
        sync: false
      - key: STRIPE_PRICE_PRO
        sync: false

      # Billing enforcement (optional; enable when ready)
      - key: BILLING_REQUIRE_ACTIVE_SUBSCRIPTION
        value: "false"
      - key: BILLING_GRACE_DAYS
        value: "0"

      # CSRF: set to your Render URL(s), e.g. https://your-app.onrender.com
      - key: WTF_CSRF_TRUSTED_ORIGINS
        sync: false

      # Storage/logging (uses the /data disk)
      - key: UPLOAD_FOLDER
        value: /data/uploads
      - key: LOG_FILE
        value: /data/logs/timetracker.log

      # Background jobs: set to false if you scale web instances > 1.
      - key: SCHEDULER_ENABLED
        value: "true"

      # Render runs migrations in preDeployCommand; skip in-container migration logic.
      - key: SKIP_STARTUP_MIGRATIONS
        value: "true"
      - key: SKIP_DB_INIT
        value: "true"

      # Redis is optional (used for scaling); keep off unless you add a Redis service.
      - key: REDIS_ENABLED
        value: "false"

databases:
  - name: timetracker-db
    plan: basic-1gb
    region: frankfurt
