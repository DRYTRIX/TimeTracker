{% extends "base.html" %}

{% block title %}{{ _('Metrics Server Status') }} - {{ _('Admin') }}{% endblock %}

{% block content %}
<div class="container mt-4">
	<div class="row">
		<div class="col-12">
			<div class="d-flex justify-content-between align-items-center mb-4">
				<h1><i class="fas fa-chart-bar"></i> {{ _('Metrics Server Status') }}</h1>
				<div>
					<a href="{{ url_for('admin.license_test') }}" class="btn btn-info">
						<i class="fas fa-vial"></i> {{ _('Test Connection') }}
					</a>
					<a href="{{ url_for('admin.license_restart') }}" class="btn btn-warning">
						<i class="fas fa-redo"></i> {{ _('Restart Client') }}
					</a>
					<a href="{{ url_for('admin.admin_dashboard') }}" class="btn btn-secondary">
						<i class="fas fa-arrow-left"></i> {{ _('Back to Dashboard') }}
					</a>
				</div>
			</div>

			{% with messages = get_flashed_messages(with_categories=true) %}
				{% if messages %}
					{% for category, message in messages %}
						<div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show" role="alert">
							{{ message }}
							<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="{{ _('Close') }}"></button>
						</div>
					{% endfor %}
				{% endif %}
			{% endwith %}

			<div class="row">
				<div class="col-md-6">
					<div class="card">
						<div class="card-header">
							<h5 class="card-title mb-0">
								<i class="fas fa-info-circle"></i> {{ _('Client Information') }}
							</h5>
						</div>
						<div class="card-body">
							<table class="table table-borderless">
								<tr>
									<td><strong>{{ _('App Identifier:') }}</strong></td>
									<td><span class="badge bg-primary">{{ status.app_identifier }}</span></td>
								</tr>
								<tr>
									<td><strong>{{ _('App Version:') }}</strong></td>
									<td><span class="badge bg-secondary">{{ status.app_version }}</span></td>
								</tr>
								<tr>
									<td><strong>{{ _('Instance ID:') }}</strong></td>
									<td><code>{{ status.instance_id or _('Not registered') }}</code></td>
								</tr>
								<tr>
									<td><strong>{{ _('Registration Status:') }}</strong></td>
									<td>
										{% if status.is_registered %}
											<span class="badge bg-success">{{ _('Registered') }}</span>
										{% else %}
											<span class="badge bg-warning">{{ _('Not Registered') }}</span>
										{% endif %}
									</td>
								</tr>
							</table>
						</div>
					</div>
				</div>

				<div class="col-md-6">
					<div class="card">
						<div class="card-header">
							<h5 class="card-title mb-0">
								<i class="fas fa-heartbeat"></i> {{ _('Connection Status') }}
							</h5>
						</div>
						<div class="card-body">
							<table class="table table-borderless">
								<tr>
									<td><strong>{{ _('Client Running:') }}</strong></td>
									<td>
										{% if status.is_running %}
											<span class="badge bg-success">{{ _('Running') }}</span>
										{% else %}
											<span class="badge bg-danger">{{ _('Stopped') }}</span>
										{% endif %}
									</td>
								</tr>
								<tr>
									<td><strong>{{ _('Server Health:') }}</strong></td>
									<td>
										{% if status.server_healthy %}
											<span class="badge bg-success">{{ _('Healthy') }}</span>
										{% else %}
											<span class="badge bg-danger">{{ _('Not Responding') }}</span>
										{% endif %}
									</td>
								</tr>
								<tr>
									<td><strong>{{ _('Offline Data:') }}</strong></td>
									<td>
										{% if status.offline_data_count > 0 %}
											<span class="badge bg-warning">{{ status.offline_data_count }} {{ _('pending') }}</span>
										{% else %}
											<span class="badge bg-success">{{ _('None') }}</span>
										{% endif %}
									</td>
								</tr>
								<tr>
									<td><strong>{{ _('Server URL:') }}</strong></td>
									<td><code>{{ status.server_url }}</code></td>
								</tr>
								<tr>
									<td><strong>{{ _('Heartbeat Interval:') }}</strong></td>
									<td>{{ status.heartbeat_interval }} {{ _('seconds') }}</td>
								</tr>
								<tr>
									<td><strong>{{ _('Analytics Enabled:') }}</strong></td>
									<td>
										{% if status.analytics_enabled %}
											<span class="badge bg-success">{{ _('Yes') }}</span>
										{% else %}
											<span class="badge bg-secondary">{{ _('No') }}</span>
										{% endif %}
									</td>
								</tr>
							</table>
						</div>
					</div>
				</div>
			</div>

			<div class="row mt-4">
				<div class="col-12">
					<div class="card">
						<div class="card-header">
							<h5 class="card-title mb-0">
								<i class="fas fa-cogs"></i> {{ _('Configuration') }}
							</h5>
						</div>
						<div class="card-body">
							<div class="alert alert-info">
								<h6><i class="fas fa-info-circle"></i> {{ _('About This Implementation') }}</h6>
								<p class="mb-0">
									{{ _('This TimeTracker application communicates with a metrics server for monitoring and analytics purposes only.') }}
									<strong>{{ _('No license is required') }}</strong> {{ _('to use the application. The metrics server is used to:') }}
								</p>
								<ul class="mb-0 mt-2">
									<li>{{ _('Track application usage and features') }}</li>
									<li>{{ _('Monitor system health and performance') }}</li>
									<li>{{ _('Collect analytics data for improvement') }}</li>
									<li>{{ _('Provide support and troubleshooting information') }}</li>
								</ul>
							</div>
							
							<div class="row">
								<div class="col-md-6">
									<h6>{{ _('Server Configuration') }}</h6>
									<ul class="list-unstyled">
										<li><strong>{{ _('Server URL:') }}</strong> <code>{{ status.server_url }}</code></li>
										<li><strong>{{ _('Heartbeat Interval:') }}</strong> {{ status.heartbeat_interval }} {{ _('seconds') }}</li>
									</ul>
								</div>
								<div class="col-md-6">
									<h6>{{ _('Features') }}</h6>
									<ul class="list-unstyled">
										<li><i class="fas fa-check text-success"></i> {{ _('Automatic instance registration') }}</li>
										<li><i class="fas fa-check text-success"></i> {{ _('Periodic heartbeats') }}</li>
										<li><i class="fas fa-check text-success"></i> {{ _('Usage data collection') }}</li>
										<li><i class="fas fa-check text-success"></i> {{ _('Offline data storage') }}</li>
										<li><i class="fas fa-check text-success"></i> {{ _('Graceful error handling') }}</li>
									</ul>
								</div>
							</div>
							
							<div class="row mt-3">
								<div class="col-12">
									<h6>{{ _('Privacy & Analytics Settings') }}</h6>
									<div class="alert alert-warning">
										<i class="fas fa-shield-alt me-2"></i>
										<strong>{{ _('Analytics Setting:') }}</strong> 
										{% if settings and settings.allow_analytics %}
											<span class="badge bg-success">{{ _('Enabled') }}</span>
											<small class="text-muted ms-2">{{ _('System information is being shared with the metrics server') }}</small>
										{% else %}
											<span class="badge bg-secondary">{{ _('Disabled') }}</span>
											<small class="text-muted ms-2">{{ _('System information sharing is disabled') }}</small>
										{% endif %}
										<br>
										<small class="text-muted">
											<i class="fas fa-info-circle me-1"></i>
											{{ _('This setting can be changed in') }} <a href="{{ url_for('admin.settings') }}">{{ _('System Settings') }}</a>. 
											<strong>{{ _('License validation continues to work regardless of this setting.') }}</strong>
										</small>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
{% endblock %}
