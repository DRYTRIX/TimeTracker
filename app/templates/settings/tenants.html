{% extends "base.html" %}
{% from "components/ui.html" import page_header %}

{% block content %}
{% set breadcrumbs = [{'text': 'Settings', 'url': url_for('settings.index')}, {'text': 'Tenants'}] %}

{{ page_header(
    icon_class='fas fa-building',
    title_text=_('Tenants'),
    subtitle_text=_('Switch between your workspaces'),
    breadcrumbs=breadcrumbs
) }}

<div class="mb-4">
  <a href="{{ url_for('settings.create_tenant') }}" class="bg-primary text-white px-4 py-2 rounded hover:bg-blue-600 inline-block">
    {{ _('Create tenant') }}
  </a>
</div>

<div class="bg-card-light dark:bg-card-dark rounded-lg shadow p-6">
  {% if items %}
    <div class="overflow-x-auto">
      <table class="min-w-full">
        <thead>
          <tr class="text-left text-sm text-text-muted-light dark:text-text-muted-dark">
            <th class="py-2 pr-4">{{ _('Tenant') }}</th>
            <th class="py-2 pr-4">{{ _('Role') }}</th>
            <th class="py-2 pr-4">{{ _('Status') }}</th>
            <th class="py-2 pr-4">{{ _('Actions') }}</th>
          </tr>
        </thead>
        <tbody class="text-sm">
          {% for it in items %}
            <tr class="border-t border-gray-200 dark:border-gray-700">
              <td class="py-3 pr-4">
                <div class="font-medium">{{ it.tenant.name if it.tenant.name else it.tenant.slug }}</div>
                <div class="text-xs text-text-muted-light dark:text-text-muted-dark">{{ it.tenant.slug }}</div>
              </td>
              <td class="py-3 pr-4">
                <span class="px-2 py-1 rounded bg-gray-100 dark:bg-gray-800">{{ it.role }}</span>
              </td>
              <td class="py-3 pr-4">
                {% set st = (it.tenant.status or 'active') %}
                {% if st == 'active' %}
                  <span class="px-2 py-1 rounded bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 text-xs">{{ _('active') }}</span>
                {% elif st == 'suspended' %}
                  <span class="px-2 py-1 rounded bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 text-xs">{{ _('suspended') }}</span>
                {% elif st == 'deleted' %}
                  <span class="px-2 py-1 rounded bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200 text-xs">{{ _('deleted') }}</span>
                {% else %}
                  <span class="px-2 py-1 rounded bg-gray-100 dark:bg-gray-800 text-xs">{{ st }}</span>
                {% endif %}

                {% if it.is_current %}
                  <span class="ml-2 text-green-700 dark:text-green-400 text-xs">{{ _('current') }}</span>
                {% endif %}
              </td>
              <td class="py-3 pr-4">
                {% if it.is_current %}
                  <span class="text-text-muted-light dark:text-text-muted-dark">{{ _('You are here') }}</span>
                {% else %}
                  <a class="text-primary hover:underline" href="{{ it.switch_url }}">{{ _('Switch') }}</a>
                {% endif %}

                {% if it.can_leave %}
                  <form method="post" action="{{ it.leave_url }}" class="inline">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="submit" class="ml-3 text-red-600 hover:underline" onclick="return confirm('{{ _('Leave this tenant?') }}')">
                      {{ _('Leave') }}
                    </button>
                  </form>
                {% else %}
                  <span class="ml-3 text-text-muted-light dark:text-text-muted-dark text-xs">{{ _('Owner (cannot leave)') }}</span>
                {% endif %}

                {% if it.role == 'owner' %}
                  <a class="ml-3 text-red-600 hover:underline" href="{{ url_for('settings.tenant_danger', tenant_id=it.tenant.id) }}">
                    {{ _('Danger') }}
                  </a>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="text-sm text-text-muted-light dark:text-text-muted-dark">
      {{ _('No tenant memberships found.') }}
    </div>
  {% endif %}
</div>

{% endblock %}

