{% extends "base.html" %}
{% from "components/ui.html" import page_header %}

{% block content %}
{% set breadcrumbs = [{'text': _('Billing'), 'url': url_for('billing.billing_home')}, {'text': _('Org size')}] %}

{{ page_header(
    icon_class='fas fa-users',
    title_text=_('Choose your org size'),
    subtitle_text=_('This determines your plan and seat quantity'),
    breadcrumbs=breadcrumbs
) }}

<div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
  <div class="bg-card-light dark:bg-card-dark rounded-lg shadow p-6">
    <div class="text-sm text-text-muted-light dark:text-text-muted-dark">{{ _('Tenant') }}</div>
    <div class="text-xl font-semibold mt-1">{{ tenant.slug }}</div>
    <div class="text-sm text-text-muted-light dark:text-text-muted-dark mt-4">{{ _('Members') }}</div>
    <div class="text-2xl font-bold">{{ members_count }} / {{ seat_limit }}</div>
    <div class="mt-4">
      <a href="{{ url_for('billing.billing_members') }}" class="text-primary hover:underline">
        {{ _('View members') }}
      </a>
    </div>
  </div>

  <div class="bg-card-light dark:bg-card-dark rounded-lg shadow p-6">
    <div class="text-sm text-text-muted-light dark:text-text-muted-dark">{{ _('Current selection') }}</div>
    <div class="text-xl font-semibold mt-1">
      {{ (billing.tier if billing and billing.tier else _('not set'))|upper }}
    </div>
    <div class="text-sm text-text-muted-light dark:text-text-muted-dark mt-4">{{ _('Seats') }}</div>
    <div class="text-2xl font-bold">{{ billing.seat_quantity if billing and billing.seat_quantity else 1 }}</div>
    {% if mode == 'onboarding' %}
      <div class="mt-3 text-sm text-text-muted-light dark:text-text-muted-dark">
        {{ _('To activate this tenant, choose your org size and complete checkout.') }}
      </div>
    {% endif %}
  </div>

  <div class="bg-card-light dark:bg-card-dark rounded-lg shadow p-6">
    <div class="text-sm text-text-muted-light dark:text-text-muted-dark">{{ _('Manage billing') }}</div>
    <div class="text-sm text-text-muted-light dark:text-text-muted-dark mt-2">
      {{ _('After checkout you can change seat quantity or use the Stripe Billing Portal.') }}
    </div>
    <form class="mt-4" method="post" action="{{ url_for('billing.billing_portal') }}">
      <button type="submit" class="bg-primary text-white px-4 py-2 rounded hover:bg-blue-600 w-full">
        {{ _('Open Billing Portal') }}
      </button>
    </form>
    <div class="text-xs text-text-muted-light dark:text-text-muted-dark mt-3">
      {{ _('If the portal is not available yet, complete checkout first.') }}
    </div>
  </div>
</div>

<div class="bg-card-light dark:bg-card-dark rounded-lg shadow p-6">
  <h2 class="text-lg font-semibold mb-2">{{ _('Select org size') }}</h2>
  <div class="text-sm text-text-muted-light dark:text-text-muted-dark mb-6">
    {{ _('Pricing is monthly. Team and Pro are seat-based (total = seats × per-seat price).') }}
  </div>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
    <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
      <div class="text-lg font-semibold">{{ _('Solo') }}</div>
      <div class="text-sm text-text-muted-light dark:text-text-muted-dark">{{ _('1 user') }}</div>
      <div class="text-sm mt-2">{{ _('5 EUR / month') }}</div>
      <form method="post" action="{{ url_for('billing.start_checkout') }}" class="mt-4">
        <input type="hidden" name="tier" value="basic">
        <input type="hidden" name="seats" value="1">
        {% if mode == 'onboarding' %}<input type="hidden" name="success" value="members">{% endif %}
        <button type="submit" class="bg-primary text-white px-4 py-2 rounded hover:bg-blue-600 w-full">
          {{ _('Continue') }}
        </button>
      </form>
    </div>

    <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
      <div class="text-lg font-semibold">{{ _('Team') }}</div>
      <div class="text-sm text-text-muted-light dark:text-text-muted-dark">{{ _('2–5 users') }}</div>
      <div class="text-sm mt-2">{{ _('7 EUR / month per user') }}</div>
      <form method="post" action="{{ url_for('billing.start_checkout') }}" class="mt-4">
        <input type="hidden" name="tier" value="team">
        {% if mode == 'onboarding' %}<input type="hidden" name="success" value="members">{% endif %}
        <label class="block text-sm mb-2">{{ _('Seats') }}</label>
        <input name="seats" type="number" min="1" max="5"
               value="{{ (billing.seat_quantity if billing and billing.tier=='team' else (members_count if members_count>0 else 2)) }}"
               class="w-full px-3 py-2 border rounded bg-white dark:bg-gray-800">
        <button type="submit" class="bg-primary text-white px-4 py-2 rounded hover:bg-blue-600 w-full mt-3">
          {{ _('Continue') }}
        </button>
      </form>
      <div class="text-xs text-text-muted-light dark:text-text-muted-dark mt-2">
        {{ _('Max 5 seats on Team.') }}
      </div>
    </div>

    <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
      <div class="text-lg font-semibold">{{ _('Pro') }}</div>
      <div class="text-sm text-text-muted-light dark:text-text-muted-dark">{{ _('6+ users (unlimited)') }}</div>
      <div class="text-sm mt-2">{{ _('15 EUR / month per user') }}</div>
      <form method="post" action="{{ url_for('billing.start_checkout') }}" class="mt-4">
        <input type="hidden" name="tier" value="pro">
        {% if mode == 'onboarding' %}<input type="hidden" name="success" value="members">{% endif %}
        <label class="block text-sm mb-2">{{ _('Seats') }}</label>
        <input name="seats" type="number" min="1"
               value="{{ (billing.seat_quantity if billing and billing.tier=='pro' else (members_count if members_count>0 else 6)) }}"
               class="w-full px-3 py-2 border rounded bg-white dark:bg-gray-800">
        <button type="submit" class="bg-primary text-white px-4 py-2 rounded hover:bg-blue-600 w-full mt-3">
          {{ _('Continue') }}
        </button>
      </form>
      <div class="text-xs text-text-muted-light dark:text-text-muted-dark mt-2">
        {{ _('No max seats on Pro; you choose the quantity.') }}
      </div>
    </div>
  </div>

  <div class="mt-6 text-xs text-text-muted-light dark:text-text-muted-dark">
    {{ _('Stripe webhook endpoint') }}: <code class="px-2 py-1 bg-gray-100 dark:bg-gray-800 rounded">/webhooks/stripe/billing</code>
  </div>
</div>

{% endblock %}

