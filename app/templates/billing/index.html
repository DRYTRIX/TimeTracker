{% extends "base.html" %}
{% from "components/ui.html" import page_header %}

{% block content %}
{% set breadcrumbs = [{'text': 'Billing'}] %}

{{ page_header(
    icon_class='fas fa-credit-card',
    title_text='Billing',
    subtitle_text='Manage your subscription and seats for this tenant',
    breadcrumbs=breadcrumbs
) }}

<div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
  <div class="bg-card-light dark:bg-card-dark rounded-lg shadow p-6">
    <div class="text-sm text-text-muted-light dark:text-text-muted-dark">{{ _('Tenant') }}</div>
    <div class="text-xl font-semibold mt-1">{{ tenant.slug }}</div>
    <div class="text-sm text-text-muted-light dark:text-text-muted-dark mt-4">{{ _('Members') }}</div>
    <div class="text-2xl font-bold">{{ members_count }} / {{ seat_limit }}</div>
    <div class="mt-4">
      <a href="{{ url_for('billing.billing_members') }}" class="text-primary hover:underline">
        {{ _('View members') }}
      </a>
    </div>
  </div>

  <div class="bg-card-light dark:bg-card-dark rounded-lg shadow p-6">
    <div class="text-sm text-text-muted-light dark:text-text-muted-dark">{{ _('Current plan') }}</div>
    <div class="text-xl font-semibold mt-1">
      {{ (billing.tier if billing else 'basic')|upper }}
    </div>
    <div class="text-sm text-text-muted-light dark:text-text-muted-dark mt-4">{{ _('Status') }}</div>
    <div class="text-base font-medium mt-1">
      {{ billing.status if billing and billing.status else _('not set') }}
    </div>
    {% if billing and billing.current_period_end %}
      <div class="text-sm text-text-muted-light dark:text-text-muted-dark mt-2">
        {{ _('Renews/ends') }}: {{ billing.current_period_end.strftime('%Y-%m-%d') }}
      </div>
    {% endif %}
    <form class="mt-4" method="post" action="{{ url_for('billing.billing_portal') }}">
      <button type="submit" class="bg-primary text-white px-4 py-2 rounded hover:bg-blue-600">
        {{ _('Open Billing Portal') }}
      </button>
    </form>
  </div>

  <div class="bg-card-light dark:bg-card-dark rounded-lg shadow p-6">
    <div class="text-sm text-text-muted-light dark:text-text-muted-dark">{{ _('Seats') }}</div>
    <div class="text-sm text-text-muted-light dark:text-text-muted-dark mt-2">
      {{ _('Basic is fixed at 1 seat. Team is max 5 seats. Pro has no max (you choose seats).') }}
    </div>
    <form class="mt-4 flex gap-2 items-center" method="post" action="{{ url_for('billing.update_seats') }}">
      <input name="seats" type="number" min="1" value="{{ billing.seat_quantity if billing else 1 }}"
             class="w-28 px-3 py-2 border rounded bg-white dark:bg-gray-800">
      <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
        {{ _('Update') }}
      </button>
    </form>
  </div>
</div>

<div class="bg-card-light dark:bg-card-dark rounded-lg shadow p-6">
  <h2 class="text-lg font-semibold mb-2">{{ _('Org size') }}</h2>
  <div class="text-sm text-text-muted-light dark:text-text-muted-dark mb-4">
    {{ _('Change your plan and seat quantity (upgrade/downgrade).') }}
  </div>
  <a href="{{ url_for('billing.billing_org_size') }}" class="bg-primary text-white px-4 py-2 rounded hover:bg-blue-600 inline-block">
    {{ _('Change org size') }}
  </a>
</div>

{% endblock %}

